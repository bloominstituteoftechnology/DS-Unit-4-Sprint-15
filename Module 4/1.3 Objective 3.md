# Local LLM setup

### Install Dependencies

```bash
pip install llama-cpp-python
```

### Marv the Sarcastic Bot

```python
from llama_cpp import Llama


system_prompt = "You are Marv, a chatbot that reluctantly answers " \
                "questions with sarcastic responses."

user_prompt = "In the coming months AI will"

prompt = f"### Instruction: {system_prompt}\n\n" \
         f"{user_prompt}\n\n" \
         f"### Response:\n"

llm = Llama(model_path="./app/models/openorca-platypus2-13b.Q4_K_M.gguf")

raw_output = llm(
    prompt,
    stop=["###"],
    max_tokens=-1,
    temperature=1,
)

reply = raw_output.get("choices")[0].get("text").strip()
print(reply)
```

1. **System Prompt**: It serves as the instruction for the model, defining its persona. In this example, the persona is "Marv, a chatbot that reluctantly answers questions with sarcastic responses." This instructs the model to generate replies that are sarcastic in nature. The system prompt is often crucial in setting the tone, style, and context for how the language model should behave.

2. **User Prompt**: This is the query or statement from the user. The language model takes this as the actual question or issue to respond to. In your example, the user prompt is "In the coming months AI will," which would be a starting point for the model to generate a continuation.

3. **Composite Prompt**: Both the system and user prompts are combined to create a composite prompt (`prompt`). This composite prompt will be passed to the LLM. The structure is important; by preceding the user prompt with the system prompt and the instruction, the model is "primed" to answer in the persona set by the system prompt. 
   - For instance, if the user prompt is "tell me a joke," and the system prompt sets the persona as sarcastic, the generated reply might not be a straightforward joke but rather a sarcastic comment about telling jokes. 
   - The `### Instruction: {system_prompt}` and `### Response:` parts act as markers, helping the model to understand the roles of the system prompt and where its reply should start, respectively. This is particularly useful in fine-tuned models that have been trained to recognize such structural cues.

4. `stop=["###"]`: Stops generating tokens when it encounters "###". This is not strictly necessary but helps to keep the model from talking to itself in an endless loop. Some models are more prone to this issue than others.

5. `max_tokens`: No limit on the number of tokens to be generated when set to -1, otherwise this controls the maximum output by truncation if necessary.

6. `temperature`: Controls the randomness of the output (lower means less random). Ranges from 0 (deterministic) to 1 (non-deterministic). For many models this setting is more of a suggestion than a directive.
